<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8" />
	<link REL="SHORTCUT ICON" HREF="img/favicon.ico">
	<title>PrimaryAccess</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
	<link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/smoothness/jquery-ui.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
	<script src="lib/jquery.ui.touch-punch.min.js"></script>
	<style type="text/css">
		 body { 			font-family: Verdana,Geneva,sans-serif; font-size: 13px;  
							padding: 0; margin:0px
							}
		.pa-main {		 	width: 100%;  background-color:#eee; height: vh; overflow-y: auto;
							}
		.pa-script {		position: absolute; width: 50%; height: 100%; left:0; top:0; 
							background-color:#fff; height: calc(100% - 150px); overflow-y: scroll;
							}
		.pa-scriptPix {		display: inline-block; width: 126px; padding: 16px; height:80%; cursor:url(img/moveud.cur),auto;
							}
		.pa-scriptPic {		width:128px; position: absolute; left: 16px;
							}
		.pa-scriptText {	display: inline-block; width: calc(100% - 240px); vertical-align: top;
							padding: 16px; font-size: 24px; line-height: 175%;
							}
		.pa-scriptText:focus { outline:none
							}
		.pa-player {		position: absolute; width: 50%; left:50%; top: 0px;
							background-color:#ccc;  height:calc(100% - 150px); float: top
							}
		.pa-bin {			position: absolute; width: 100%; left:0; top: calc(100% - 150px);
							background-color:#eee; 	border-top: 1px solid #ccc;
							}
		.pa-binMenu {		display: inline-block; vertical-align: top; text-align:center; width: 150px;
							}							
		.pa-pix {			display: inline-block; overflow-x: scroll;  white-space: nowrap; width: calc(100% - 160px); 
							}
		.pa-pic {			padding: 8px; padding-right: 0; padding-bottom:4px; display: inline-block; cursor:url(img/movelr.cur),auto;
							}
		.pa-meta {			position: absolute;  width: 320px; padding: 16px; border-radius: 8px; font-size: 14px;
							background-color: #eee; border: 1px solid #999; box-shadow: -4px -4px 12px 2px #aaa;
							}
		.pa-arrow-down {  	position: absolute; left: calc(50% - 14px); top: 100%; width: 0; height: 0; 
							border-left: 10px solid transparent; border-right: 10px solid transparent;  border-top: 10px solid #bbb;
							}
		.pa-webpage	{ 		position: absolute; padding: 12px; border-radius: 6px; display: none; padding: 12px; height:auto; font-size: 14px; 
							border: 1px solid #999; background-color:#eee; font-size: 11px; box-shadow: 4px 4px 12px 2px #aaa;
							}
		.pa-is {			border-radius:10px;padding-left:8px;padding-right:8px;padding-top:1px;
							border:1px solid #999;font-size:12px;height:20px;width:200px;
							}
		.pa-bs {			border-radius:10px;padding-left:8px;padding-right:8px;padding-top:1px;
							border:1px solid #999;font-size:12px;height:20px;color:#666;cursor:pointer;
							}
		.pa-arrow {  		cursor:pointer; vertical-align: 2px; display: none;
							}

 
</style>
</head>
<body>
	<div id="mainDiv" class="pa-main">
		<div id="scriptDiv" class="pa-script">
			<div id="scriptPixDiv" class="pa-scriptPix"></div>	
			<div style="position:fixed;background-color:#ccc;width:6px;height:calc(100% - 186px);top:20px;left:160px;border-radius:2px;"></div>	
			<div id="scriptTextDiv" contenteditable="true" class="pa-scriptText">
				In the 1954 Brown v. Board of Education decision, segregated schools were declared unconstitutional. 
				This landmark decision sparked the modern Civil Rights movement.
				Led by Martin Luther King Jr., blacks engaged in a series of nonviolent protests throughout the southern United States.
				</div>		
		</div>	
		<div id="binDiv" class="pa-bin">
			<div id="binMenuDiv" class="pa-binMenu"></div>
			<img id='binLeftBut' src='img/leftarrow.png' class='pa-arrow'>
			<div id="binPixDiv" class="pa-pix"></div>
			<img id='binRightBut' src='img/rightarrow.png' class='pa-arrow'>
		</div>
		<div id="playerDiv" class="pa-player"></div>
	</div>

<script>

//////////////////////////////////////////////////////////////////////////////////////////////////
// MAIN 
/////////////////////////////////////////////////////////////////////////////////////////////////

	var bin=null;
	var script=null;
	var player=null;
	var isMobile=false;

	$(document).ready(function() {								        // ON PAGE LOADED
		isMobile=navigator.userAgent.match(/(ipad|iphone|ipod|android)/i) ? true : false; // Set mobile flag
		var url=window.location.search.substring(1);					 	// Get query string
		$(window).resize(ResizePanes);                                     	// On window resizing
		bin=new CBin();														// Alloc CBin module
		script=new CScript();												// Alloc CScript module
		});									
		
	function ResizePanes()
	{
		if ($(window).width() < 800) {
			$("#scriptDiv").css({ width:"100%", height: "75%" });
			$("#binDiv").css({ top: "75%" });
			$("#playerDiv").css({ width:"100%", height:"75%", left:0, top: "calc(75% + 150px)" });
			}
		else{
			$("#scriptDiv").css({ width:"50%", height:"calc(100% - 150px)" });
			$("#playerDiv").css({ width:"50%", height:"calc(100% - 150px)", left:"50%", top:0 });
			$("#binDiv").css({ top: $("#playerDiv").height() });
			}
	}

//////////////////////////////////////////////////////////////////////////////////////////////////
// SCRIPT
/////////////////////////////////////////////////////////////////////////////////////////////////

	function CScript()													// SCRIPT CONSTRUCTOR
	{
		this.pics=[];														// Alloc array									
		this.Draw();														// Show bin
		var _this=this;														// Save context

		$("#scriptPixDiv").droppable({										// HANDLE DROPS TO BIN
			accept: ".pa-pic",												// Accept only pics from bin	  
			drop: function(event,ui) {										// On drop
				    if ($(this)) {											// If something
						$("#metaDiv").remove();								// Kill popup
						var id=ui.draggable[0].id.substr(7);				// Get id
						_this.AddPic(id);									// Add to script
						Sound("ding");										// Ding
						_this.Draw();										// Show script
						}
				}
			});

		$("#scriptTextDiv")[0].addEventListener('input', function() {		// ON SCRIPT CHANGE
			_this.ResizeImageArea();										// Equilibrate fields
			});
	}

	CScript.prototype.ResizeImageArea=function() 						//	MATCH IMAGE AREA TO TEXT AREA
	{
		$("#scriptPixDiv").height($("#scriptTextDiv").height())				// Make the same
	}

	CScript.prototype.Draw=function() 									//	DRAW SCRIPT
	{
		var i,y=24,str=""
		var _this=this;														// Save context
		for (i=0;i<this.pics.length;++i) {									// For each pic
			str+="<img id='scriptPic-"+i+"' class='pa-scriptPic' ";			// Image 
			str+="src='"+this.pics[i].src+"' "								// Source
			str+="style='top:"+y+"px'>";									// Pos
			y+=100;
			}
		$("#scriptPixDiv").html(str);										// Show pix
	
		for (i=0;i<this.pics.length;++i) {									// For each pic
			$("#scriptPic-"+i).draggable( {									// Allow drag
				start: function(event, ui) {								// If starting					
					$("#metaDiv").remove();									// Kill meta popup, if any
					},
				stop: function(event, ui) {									// If stopped						
					if (ui.position.left > 180) {							// Out of area
						_this.pics.splice(ui.helper[0].id.substr(10),1);	// Delete it
						Sound("delete");									// Sound
					}
				_this.Draw();												// Redraw
				}	
			});
			}
	}

	CScript.prototype.AddPic=function(num) 								//	ADD PIC TO SCRIPT
	{
		var o={};															// Blank obj
		o.src=bin.pics[num].src;											// Add url
		o.start=0;															// add start time
		this.pics.push(o);													// Add to pics array
	}

//////////////////////////////////////////////////////////////////////////////////////////////////
// BIN
/////////////////////////////////////////////////////////////////////////////////////////////////

	function CBin()														// BIN CONSTRUCTOR
	{
		this.pics=this.LoadPics();											// Load default pics									
		this.Draw();														// Show bin
		
		var str="<img style='padding-top:16px' src='img/shantilogo.png'>"; 
		str+="<br><img  src='img/helpicon.gif'style='width:20px;margin:6px;margin-bottom:12px;cursor:pointer' onclick='bin.ShowHelp()'>"; 
		str+="<div style='color:#888;font-size:11px;line-height:100%'> &copy; 2018 University<br>of Virginia</div>";
		$("#binMenuDiv").html(str)
		$("#binDiv").disableSelection();									// Inhibit selection

		$("#binLeftBut").on("click", function() {							// Mobile scroll left
			$("#metaDiv").remove();											// Kill popup
			$("#binPixDiv").scrollLeft($("#binPixDiv").scrollLeft()-$("#binPixDiv").width()/2);
			if ($("#binPixDiv").scrollLeft())								// If scrolled
				$("#binLeftBut").show();									// Show
			else															// At start
				$("#binLeftBut").hide();									// Hide
			if (Math.abs($('#binPixDiv')[0].scrollWidth-$('#binPixDiv').outerWidth()) > 5)	// If it can scroll
				$("#binRightBut").show();									// Show
			});
		$("#binRightBut").on("click", function() {							// Right
			$("#metaDiv").remove();											// Kill popup
			$("#binPixDiv").scrollLeft($("#binPixDiv").scrollLeft()+$("#binPixDiv").width()/2);
			$("#binLeftBut").show();										// Show left
			if ($('#binPixDiv')[0].scrollWidth-$('#binPixDiv').scrollLeft()-$('#binPixDiv').outerWidth() < 20)	// If no scroll left
				$("#binRightBut").hide();									// Hide
			else															// At start
				$("#binRightBut").show();									// Show
			});
	}

	CBin.prototype.Draw=function() 										//	DRAW BIN
	{
		var i,str="";
		str+="<ul id='pixList' style='list-style-type:none;padding:0;margin:0'>"
		for (i=0;i<this.pics.length;++i) {									// For each pic
			str+="<li id='binPic-"+i+"' class='pa-pic'";					// List start
			str+="><img src='"+this.pics[i].src+"' style='margin:0;height:114px'></li>"; // Add image
			}

		$("#binPixDiv").html(str+"</ul>");									// Add to div
		$("#pixList").sortable();											// Make it sortable
 		$("#pixList").disableSelection();									// Imnhibit selection
	
		var _this=this;														// Save context
		for (i=0;i<this.pics.length;++i) {									// For each pic
			$("#binPic-"+i).on("mouseenter", function(e) {					// Add over handler
				$("#pa-webpage").remove();									// Remove old image, if any
				var id=e.currentTarget.id.substr(7);						// Get id
				_this.ShowMetaData(id);										// Show metadata popup
				});
			}
		if (isMobile) {														// Mobile doesn't show scroll bars
			if (Math.abs($('#binPixDiv')[0].scrollWidth-$('#binPixDiv').outerWidth()) > 5)	// If it can scroll
				$("#binRightBut").show();									// Show right
			$("#binPixDiv").css("width","calc(100% - 200px)");				// Shorten container div
			}		
	}

	CBin.prototype.ShowMetaData=function(num) 						//	SHOW METADATA POPUP
	{
		$("#metaDiv").remove();												// Kill old one
		var o=this.pics[num];												// Point at pic
		if (!o.title && !o.desc) 											// If nothing to show
			return;															// Quit
		var _this=this;														// Save context
		var str="<div id='metaDiv' class='pa-meta'>";						// Add div
		str+="<img id='zoomBut' src='img/zoomer.png' style='float:right;width:14px;cursor:pointer'>";	// Zoomer button
		if (o.title)														// If a title
			str+="<b>"+o.title+"</b><br><br>";								// Add it
		if (o.desc)															// If a description
			str+=o.desc;													// Add it
		if (o.link)															// If a link
			str+=" Click <a href=\""+o.link+"\" target=\"_blank\">here</a> for more information.";  // Add it
		str+="<div id='metaArrow' class='pa-arrow-down'></div>";			// Add div
		$("body").append(str+"</div>");										// Add popup
		var x=$("#binPic-"+num).offset().left-160+$("#binPic-"+num).width()/2;	// Center
		var off=x;															// Save pos
		x=Math.min(x,$(window).width()-360);								// Cap to window
		off-=x;																// Offset from end
		$("#metaArrow").css("left",Math.min(160+off,320)+"px");				// Position arrow
		var y=$("#binDiv").position().top-$("#metaDiv").height()-34;		// Align by bottom
		$("#metaDiv").offset({left:x,top:y});								// Position popup
	
		$("#scriptDiv").on("mouseenter", function() {						// Add over handler
			$("#metaDiv").remove();											// Kill old one
			});
		$("#playerDiv").on("mouseenter", function() {						// Add over handler
			$("#metaDiv").remove();											// Kill old one
			});
		$("#scriptDiv").on("click", function() {							// Add click handler
			$("#pa-webpage").remove();										// Remove old image, if any
			});
		$("#playerDiv").on("click", function() {							// Add click handler
			$("#pa-webpage").remove();										// Remove old image, if any
			});

		$("#zoomBut").on("click", function() {								// Show image popup
			_this.ShowPic(o.src,o.title);									// Show popup		
		});
	}
		
	CBin.prototype.ShowPic=function(url, title, desc) 					//	SHOW PIC
	{
		var div="#mainDiv";													// Enclosing div	
		$("#pa-webpage").remove();											// Remove old image, if any
		$("#metaDiv").remove();												// Kill metadata
		var str="<div id='pa-webpage' class='pa-webpage' style='";			// Add div
		str+="width:"+($(div).width()/2-40);								// Width
		str+="px;height:"+($("#scriptDiv").height()-44);					// Height
		str+="px;top:8px;left:8px'>";										// Finish div
		str+="<b>"+title+"</b><img id='pa-close' src='img/closedot.gif' style='float:right;cursor:pointer'><br><br>"	// Add close button
		str+="<div style='overflow-y:auto;height:calc(100% - 30px)'><img src='"+url+"' width='100%'></div>";	
		$("body").append(str+"</div>");										// Add popup
		$("#pa-webpage").fadeIn(1000);										// Fade in
		$("#pa-close").click(function() { $("#pa-webpage").remove(); });	// Remove on click of close but
	}

	CBin.prototype.ShowHelp=function() 									//	SHOW HELP
	{
		var div="#mainDiv";													// Enclosing div	
		$("#pa-webpage").remove();											// Remove old image, if any
		$("#metaDiv").remove();												// Kill metadata
		var str="<div id='pa-webpage' class='pa-webpage' style='";			// Add div
		str+="font-size:16px;width:"+($(div).width()/2-40);					// Width
		str+="px;height:"+($("#scriptDiv").height()-44);					// Height
		str+="px;top:8px;left:8px'>";										// Finish div
		str+="<b>PrimaryAccess user\'s Guide</b><img id='pa-close' src='img/closedot.gif' style='float:right;cursor:pointer'><br><br>"	// Add close button
		str+="<div style='overflow-y:auto;height:calc(100% - 30px)'>Help goes here.</div>";	
		$("body").append(str+"</div>");										// Add popup
		$("#pa-webpage").fadeIn(1000);										// Fade in
		$("#pa-close").click(function() { $("#pa-webpage").remove(); });	// Remove on click of close but
	}

	CBin.prototype.LoadPics=function() 									//	LOAD IMAGES
	{
		var pics=[];
		pics.push({ src:"//stagetools.com/primaryaccess/Test.jpg", 
			title:"Martin Luther King at Civil rights march",
			date: "1963",
			desc: "Martin Luther King delivers his \"I have a dream\" speech at the Lincoln Memorial",
			link: "//memory.loc.gov/ammem/aaohtml/exhibit/aopart9b.html#0913-0914"
			});
		pics.push({ src:"//stagetools.com/primaryaccess/Test2.jpg", 
			title:"Rosa Parks sitting on bus",
			date: "1955",
			desc: "Rosa Parks prompted outcry when she sat in the front of the bus.",
			link: "//teacher.scholastic.com/rosa"
			});
		pics.push({ src:"//stagetools.com/primaryaccess/Test10.jpg", 
			title:"Brown vs. Board of Education",
			date: "1954",
			desc: "George E.C. Hayes, Thurgood Marshall, and James Nabrit, congratulating each other, following Supreme Court decision declaring segregation unconstitutional.",
			link: "//memory.loc.gov/ammem/aaohtml/exhibit/aopart9b.html#09c"
			});
		pics.push({ src:"//stagetools.com/primaryaccess/Test3.jpg", 
			title:"The Little Rock Nine",
			date: "1957",
			desc: "After the 1954 Brown school-desegregation decision, Little Rock school board officials decided to begin desegregation.",
			link: "//memory.loc.gov/ammem/aaohtml/exhibit/aopart9.html#0918"
			});
		pics.push({ src:"//stagetools.com/primaryaccess/Test4.jpg", 
			title:"The Little Rock Nine letter - Page 1",
			date: "1957",
			desc: "Letter from Daisy Bates to Roy Wilkins.",
			link: "//memory.loc.gov/ammem/aaohtml/exhibit/aopart9.html#0918"
			});
		pics.push({ src:"//stagetools.com/primaryaccess/Test5.jpg", 
			title:"The Little Rock Nine letter - Page 2",
			date: "1957",
			desc: "Letter from Daisy Bates to Roy Wilkins.",
			link: "//memory.loc.gov/ammem/aaohtml/exhibit/aopart9.html#0918"
			});			
		pics.push({ src:"//stagetools.com/primaryaccess/Test6.jpg", 
			title:"Greensboro Lunch Counter Sit-in",
			date: "1960",
			desc: "Ronald Martin, Robert Patterson, and Mark Martin stage sit-down strike after being refused service at an F.W. Woolworth luncheon counter, Greensboro, NC.",
			link: "//memory.loc.gov/ammem/aaohtml/exhibit/aopart9b.html#0909"
			});
		pics.push({ src:"//stagetools.com/primaryaccess/Test7.jpg", 
			title:"Roger Wilkins, head of NAACP",
			date: "1957",
			desc: "Wilkins was excecutive secretary of the NAACP during the Little Rock Nine timeframe.",
			link: "//memory.loc.gov/ammem/aaohtml/exhibit/aopart9.html#0918"
			});
		pics.push({ src:"//stagetools.com/primaryaccess/Test8.jpg", 
			title:"Civil rights march on Washington",
			date: "1963",
			desc: "The August 28, 1963, March on Washington riveted the nation&apos;s attention. Rather than the anticipated hundred thousand marchers, more than twice that number appeared, astonishing even its organizers.",
			link: "//memory.loc.gov/ammem/aaohtml/exhibit/aopart9b.html#0913-0914"
			});
		return pics;
	}
	
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// HELPERS
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

	function DialogBox(title, content, width, callback, callback2) 			// DIALOG BOX
	{
		$("#dialogDiv").remove();												
		$("body").append("<div class='unselectable' id='dialogDiv'></div>");														
		var str="<p><img src='img/logo32.png' style='vertical-align:-10px'/>&nbsp;&nbsp;";								
		str+="<span id='gtBoxTi'style='font-size:18px;text-shadow:1px 1px #ccc;color:#666'><b>"+title+"</b></span><p>";
		str+="<div style='font-size:14px;margin:14px'>"+content+"</div>";
		$("#dialogDiv").append(str);	
		$("#dialogDiv").dialog({ width:Math.abs(width), buttons: {
					            	"OK": 		function() { if (callback)
					            								callback(); 
					            								$(this).remove();  
					            								},
					            	"Cancel":  	function() { if (callback2)	            		
					            								callback2();
					            								$(this).remove(); }
									}});	
		if (width < 0)
			$("#dialogDiv").dialog("option","position",{ my:"left top", at:"left top", of:this.parent });
		else
			$("#dialogDiv").dialog("option","position",{ my:"center", at:"center", of:this.parent });
	}


	function trace(msg, p1, p2, p3, p4)										// CONSOLE 
	{
		if (p4 != undefined)
			console.log(msg,p1,p2,p3,p4);
		else if (p3 != undefined)
			console.log(msg,p1,p2,p3);
		else if (p2 != undefined)
			console.log(msg,p1,p2);
		else if (p1 != undefined)
			console.log(msg,p1);
		else
			console.log(msg);
	}

	function Sound(sound, mute)												// PLAY SOUND
	{
		var snd=new Audio();													// Init audio object
		if (!snd.canPlayType("audio/mpeg") || (snd.canPlayType("audio/mpeg") == "maybe")) 
			snd=new Audio("img/"+sound+".ogg");									// Use ogg
		else	
			snd=new Audio("img/"+sound+".mp3");									// Use mp3
		if (!mute)	{															// If not initing or muting	
			snd.volume=50/100;													// Set volume
			snd.play();															// Play it
			}
		}
	
	function MakeSelect(id, multi, items, sel, extra, values)				// CREATE HTML SELECT
	{
		var	str="<select class='pa-bs' id='"+id+"'";							// Header
		if (multi)																// Multi select
			str+="multiple='multiple' size='"+multi+"'";						// Add flag
		if (extra)																// If extra param
			str+=extra;															// Add them
		str+=">";																// End header
		for (i=0;i<items.length;++i) {											// For each option
			str+="<option";														// Add tag
			if (sel == items[i])												// If selected
				str+=" selected='selected'"										// Add tag
			if (values && values[i])											// If has a value
				str+=" value='"+values[i]+"'";									// Add it
			str+=">"+items[i]+"</option>";										// End option
			}	
		return str+"</select>";													// End select				
	}
	
</script>
</body>
</html>
